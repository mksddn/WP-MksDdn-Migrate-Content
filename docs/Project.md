## MksDdn Migrate Content — проектная документация

### 1. Назначение и цели
**Цель**: преобразовать существующий mu-plugin `mksddn-migrate-content` в полноценный независимый плагин WordPress «MksDdn Migrate Content», публикуемый в каталоге WordPress.org и обновляемый независимо во множестве проектов.

**Ключевые задачи**:
- Выделить код в отдельный плагин в директории `mksddn-migrate-content`.
- Обеспечить соответствие требованиям каталога плагинов и прохождение проверки WP Plugin Check (PCP).
- Сфокусироваться на безопасности (capabilities, nonces, sanitization, escaping) и производительности (работа с большими объёмами контента без таймаутов).
- Подготовить инфраструктуру релизов (SVN для WordPress.org, GitHub для полного проекта).

Справочник по разработке плагинов WordPress: [Plugin Handbook](https://developer.wordpress.org/plugins/).

### 2. Область применения
Плагин предназначен для экспорта/импорта контента между сайтами WordPress. Начальный фокус — перенос отдельных страниц (и связанных метаданных), далее — расширение на другие типы записей/таксономии по мере необходимости.

### 3. Архитектура
#### 3.1. Структура репозитория
- Корень проекта: документация (`/docs`), служебные файлы и правила разработки.
- Директория плагина: `mksddn-migrate-content/` — единственная директория, публикуемая в WordPress.org SVN.

#### 3.2. Текущие файлы плагина
- `mksddn-migrate-content/export-import-single-page.php`
- `mksddn-migrate-content/includes/class-export-handler.php`
- `mksddn-migrate-content/includes/class-export-import-admin.php`
- `mksddn-migrate-content/includes/class-import-handler.php`
- `mksddn-migrate-content/includes/class-options-helper.php`

#### 3.3. Целевое разбиение модулей
- Bootstrap плагина: главный файл плагина с заголовком, регистрацией хуков, загрузкой переводов.
- `Admin UI`: регистрация меню/страниц настроек, формы экспорта/импорта, уведомления, нонсы, проверки прав.
- `Export Handler`: бизнес-логика экспорта (сериализация данных, фильтры, ограничения объёма).
- `Import Handler`: валидация/санитизация входных данных, маппинг сущностей, транзакционность (насколько позволяет WP), отчёт об изменениях.
- `Options Helper`: централизованная работа с Settings API и опциями плагина.
- Локализация: загрузка текстового домена `mksddn-migrate-content`.

#### 3.4. Потоки данных
- Export: админ-форма → проверка прав и nonce → `Export Handler` → отдача файла (JSON) или скачивание.
- Import: загрузка файла в админке → проверка прав и nonce → `Import Handler` → создание/обновление сущностей → отчёт.

### 4. Требования и стандарты
- Минимальные версии: WordPress ≥ 6.x (уточнить в `qa.md`), PHP ≥ 7.4/8.0 (уточнить). Цель — совместимость с актуально поддерживаемыми версиями.
- Coding Style: WordPress Coding Standards (PHPCS + WPCS), без неиспользуемого кода. Комментарии в коде — только на английском языке.
- Безопасность: `current_user_can`, `check_admin_referer`/`wp_verify_nonce`, `sanitize_*`, `wp_kses`, экранирование при выводе.
- Производительность: потоковая обработка, лимит партий, защита от таймаутов, избегать больших O(N) с полным чтением в память.
- Интернационализация: все строки оборачиваются в `__()/ _e()/ esc_html__()` с текстовым доменом.
- Деинсталляция: файл `uninstall.php` или `register_uninstall_hook` с безопасной очисткой опций/данных.
- Совместимость с PCP: регулярный прогон WP Plugin Check и устранение замечаний.

См. руководства и API в [Plugin Handbook](https://developer.wordpress.org/plugins/).

### 5. Технологии
- PHP, WordPress Core API (Settings API, Options API, Admin Menu, Nonces, REST/HTTP по необходимости, WP_Filesystem).
- Инструменты качества: PHPCS (WPCS), WP Plugin Check (PCP), Pre-commit hooks.
- CI (по возможности): линтеры + PCP в PR.

### 6. Жизненный цикл и релизы
- Разработка в GitHub: весь проект с документацией.
- Публикация в WordPress.org (SVN): только содержимое `mksddn-migrate-content/` (trunk/tags/assets).
- Семантическое версионирование, `readme.txt` с шорт-дескрипшеном, баннерами/иконками в `/assets/` для каталога.

### 7. Этапы разработки
1) Инициализация проекта и документации (данный этап).
2) Подготовка bootstrap-файла плагина с корректным заголовком и загрузкой переводов.
3) Переработка Admin UI (меню, страницы, формы) под стандарты безопасности и UX.
4) Жёсткая валидация/санитизация данных, защищённые загрузки файлов для импорта.
5) Интернационализация и текстовый домен.
6) Прогон PCP, устранение замечаний, доводка до каталожных требований.
7) Подготовка `readme.txt`, сборка ассетов и выкладка в SVN `trunk` + создание `tags`.

### 8. Риски и смягчение
- Большие объёмы данных → пакетная обработка, лимиты, прогресс/логи.
- Несовместимость окружений → строгая проверка версий, graceful degradation.
- Безопасность форм импорта → строгие `nonce`, cap checks, ограничения MIME/размера.

### 9. Консистентность и поддерживаемость
- Единые точки входа в опции/настройки, минимальные связности между слоями.
- Публичные API плагина (хуки/фильтры) документировать и не ломать без мажорной версии.
- Отсутствие неиспользуемого кода и комментариев; понятные имена классов/методов.

### 10. Обновление документации
Любое изменение архитектуры, API, структуры директорий или требований фиксируется в `docs/Project.md` и отражается в `docs/Tasktracker.md`/`docs/Diary.md`.

### 11. Лицензия
GPLv2 или более поздняя (совместимая с каталогом плагинов WordPress.org).


